---
layout: post
title:  "修复Go程序中的CVE-2016-2183漏洞"
date:   2024-09-13 16:30:00 +0800
categories: security
---

SSL/TLS协议信息泄露漏洞(CVE-2016-2183)可以通过nmap进行原理扫描:
```bash
# 如果没有nmap，可以通过yum安装，
yum install nmap

# 扫描命令行
nmap -sV --script ssl-enum-ciphers -p port ip_addr

# output
# | ssl-enum-ciphers:
# |   TLSv1.2:
# |     ciphers:
# |       TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 (secp256r1) - A
# |       TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 (secp256r1) - A
# |       TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256 (secp256r1) - A
# |       TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384 (secp256r1) - A
# |       TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256 (secp256r1) - A
# |       TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA (secp256r1) - A
# |       TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA (secp256r1) - A
# |       TLS_RSA_WITH_AES_256_GCM_SHA384 (rsa 4096) - A
# |       TLS_RSA_WITH_AES_128_GCM_SHA256 (rsa 4096) - A
# |       TLS_RSA_WITH_AES_256_CBC_SHA256 (rsa 4096) - A
# |       TLS_RSA_WITH_AES_128_CBC_SHA256 (rsa 4096) - A
# |       TLS_RSA_WITH_AES_256_CBC_SHA (rsa 4096) - A
# |       TLS_RSA_WITH_AES_128_CBC_SHA (rsa 4096) - A
# |     compressors:
# |       NULL
# |     cipher preference: server
# |     warnings:
# |       Key exchange (secp256r1) of lower strength than certificate key
# |   TLSv1.3:
# |     ciphers:
# |       TLS_AKE_WITH_AES_256_GCM_SHA384 (secp256r1) - A
# |       TLS_AKE_WITH_AES_128_GCM_SHA256 (secp256r1) - A
# |       TLS_AKE_WITH_CHACHA20_POLY1305_SHA256 (secp256r1) - A
# |     cipher preference: server
# |_  least strength: A
```
如果扫描结果为 least strength: C，那么你需要修复此漏洞。

修复方式,在代码中指定安全的加密哈希函数tls.Config.CipherSuites:

```go
tlsConfig := tls.Config{
    MinVersion: tls.VersionTLS12,
}
for _, v := range tls.CipherSuites() {
    tlsConfig.CipherSuites = append(tlsConfig.CipherSuites, v.ID)
}
```